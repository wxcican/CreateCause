package com.mzth.createcause.view.fragment.user;import android.content.Intent;import android.support.annotation.Nullable;import android.os.Bundle;import android.support.v7.widget.GridLayoutManager;import android.support.v7.widget.RecyclerView;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.TextView;import com.bumptech.glide.Glide;import com.bumptech.glide.request.RequestOptions;import com.chad.library.adapter.base.BaseQuickAdapter;import com.lzy.okgo.OkGo;import com.lzy.okgo.callback.StringCallback;import com.lzy.okgo.model.Response;import com.mzth.createcause.R;import com.mzth.createcause.adapter.user.UserAdapter;import com.mzth.createcause.base.BaseFragment;import com.mzth.createcause.entity.UserContent;import com.mzth.createcause.util.CommonUtil;import com.mzth.createcause.util.ConfigUtil;import com.mzth.createcause.util.RetentionDataUtil;import com.mzth.createcause.view.MainActivity;import com.mzth.createcause.view.fragment.user.commerce.CommerceActivity;import com.mzth.createcause.view.fragment.user.eaaaymessage.EssayMessageActivity;import com.mzth.createcause.view.fragment.user.info.impl.UserInfoActivity;import com.mzth.createcause.view.fragment.user.member.MyMemberActivity;import com.mzth.createcause.view.fragment.user.money.MoneyMessageActivity;import com.mzth.createcause.view.fragment.user.news.NewsCoreActivity;import com.mzth.createcause.view.fragment.user.outpupil.OutPupilActivity;import com.mzth.createcause.view.fragment.user.set.UserSetActivity;import com.mzth.createcause.view.fragment.user.task.TaskActivity;import org.json.JSONException;import org.json.JSONObject;import java.util.ArrayList;import java.util.List;public class UserFragment extends BaseFragment {    private final String USER_INFO = "个人信息";    private final String USER_TASK = "任务区";    private final String USER_MONEY = "我的资产";    private final String USER_TEAM = "我的团队";    private final String USER_PUPIL = "外门弟子";    private final String USER_ESSAY = "文章管理";    private final String USER_NEWS = "消息";    private final String USER_COLLEGE = "商学院";    private List<UserContent> mUserContents = new ArrayList<>();    private View view;    //九宫格    private RecyclerView rv_user;    //设置    private LinearLayout ll_user_set;    private UserAdapter mUserAdapter;    private String[] mHints;    private int[] mImgs;    private ImageView iv_userImg;    private TextView tv_userName;    private TextView tv_userType;    private TextView tv_userG;    @Override    protected void initView() {        rv_user = CommonUtil.getCommonUtil().bindView(view, R.id.rv_user);        ll_user_set = CommonUtil.getCommonUtil().bindView(view, R.id.ll_user_set);        iv_userImg = CommonUtil.getCommonUtil().bindView(view, R.id.iv_userImg);        tv_userName = CommonUtil.getCommonUtil().bindView(view, R.id.tv_userName);        tv_userType = CommonUtil.getCommonUtil().bindView(view, R.id.tv_userType);        tv_userG = CommonUtil.getCommonUtil().bindView(view, R.id.tv_userG);    }    @Override    protected void initSet() {        tv_userName.setText(RetentionDataUtil.getRetention().getString("userName", ""));        tv_userType.setText(RetentionDataUtil.getRetention().getString("userLevel", ""));    }    @Override    protected void initAdapter() {        rv_user.setLayoutManager(new GridLayoutManager(getActivity(), 3));        mUserAdapter = new UserAdapter(mUserContents);        rv_user.setAdapter(mUserAdapter);    }    @Override    protected void initData() {        //内部会员        mImgs = new int[]{                R.drawable.gerenxinxi_icon,                R.drawable.renwuqu_icon,                R.drawable.wodezichan_icon,                R.drawable.wodtuandui_icon,                R.drawable.waimendizi_icon,                R.drawable.wenzhangguanli_icon,                R.drawable.xiaoxi_icon,                R.drawable.shangxueyuan_icon        };        mHints = new String[]{                USER_INFO,                USER_TASK,                USER_MONEY,                USER_TEAM,                USER_PUPIL,                USER_ESSAY,                USER_NEWS,                USER_COLLEGE,        };        //外部会员        /*mImgs = new int[]{R.drawable.gerenxinxi_icon,                R.drawable.wodezichan_icon,                R.drawable.shangxueyuan_icon,                R.drawable.xiaoxi_icon};        mHints = new String[]{                USER_INFO,                USER_MONEY,                USER_COLLEGE,                USER_NEWS        };*/        for (int i = 0; i < mImgs.length; i++) {            UserContent mUserContent = new UserContent();            mUserContent.setHint(mHints[i]);            mUserContent.setImg(mImgs[i]);            mUserContents.add(mUserContent);        }        mUserAdapter.notifyDataSetChanged();    }    @Override    protected void initListner() {        //设置        ll_user_set.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                Intent mInten = new Intent();                mInten.setClass(getActivity(), UserSetActivity.class);                startActivity(mInten);            }        });        mUserAdapter.setOnItemClickListener(new BaseQuickAdapter.OnItemClickListener() {            @Override            public void onItemClick(BaseQuickAdapter adapter, View view, int position) {                userMessage(position);            }        });    }    //界面跳转    private void userMessage(int position) {        Intent mIntent = new Intent();        if (mHints[position].equals(USER_INFO)) {            //个人信息            mIntent.setClass(mContext, UserInfoActivity.class);            startActivityForResult(mIntent, 400);        } else if (mHints[position].equals(USER_TASK)) {            //任务区            mIntent.setClass(mContext, TaskActivity.class);            startActivityForResult(mIntent, 400);        } else if (mHints[position].equals(USER_MONEY)) {            //我的资产            mIntent.setClass(mContext, MoneyMessageActivity.class);            startActivityForResult(mIntent, 400);        } else if (mHints[position].equals(USER_TEAM)) {            //我的团队            CommonUtil.getCommonUtil().toast(ConfigUtil.HINT_NO_FINISH);            /*mIntent.setClass(mContext,MyMemberActivity.class);            startActivityForResult(mIntent,400);*/        } else if (mHints[position].equals(USER_PUPIL)) {            //外门弟子            CommonUtil.getCommonUtil().toast(ConfigUtil.HINT_NO_FINISH);            /*mIntent.setClass(mContext,OutPupilActivity.class);            startActivityForResult(mIntent,400);*/        } else if (mHints[position].equals(USER_ESSAY)) {            //文章管理            mIntent.setClass(mContext,EssayMessageActivity.class);            startActivityForResult(mIntent,400);        } else if (mHints[position].equals(USER_NEWS)) {            //消息            mIntent.setClass(mContext, NewsCoreActivity.class);            startActivityForResult(mIntent, 400);        } else if (mHints[position].equals(USER_COLLEGE)) {            //商学院            mIntent.setClass(mContext, CommerceActivity.class);            startActivityForResult(mIntent, 400);        }    }    @Override    protected View createView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {        view = inflater.inflate(R.layout.activity_user_fragment, container, false);        return view;    }    @Override    public void onActivityResult(int requestCode, int resultCode, Intent data) {        super.onActivityResult(requestCode, resultCode, data);        if (requestCode == 400) {            switch (resultCode) {                case 402:                    //任务                    if (getActivity() instanceof MainActivity) {                        ((MainActivity) getActivity()).selectStatus(MainActivity.STATUS_NEWS);                    }                    break;            }        }    }    @Override    public void onResume() {        super.onResume();        Log.i(TAG, "刷新数据: ");        Glide.with(mContext)                .load(RetentionDataUtil.getRetention().getString("userImg", ""))                .apply(RequestOptions.centerInsideTransform()                        .fallback(R.drawable.uesrheader)                        .centerCrop()                )                .into(iv_userImg);        OkGo.<String>post(ConfigUtil.PROPERTY)                .params("user_id",userId)                .params("auth_key",userKey)                .execute(new StringCallback() {                    @Override                    public void onSuccess(Response<String> response) {                        try {                            JSONObject mJSONObject=new JSONObject(response.body());                            if(mJSONObject.optInt("status")==1){                                JSONObject result = mJSONObject.optJSONObject("result");                                if(result!=null){                                    tv_userG.setText("今日贡献点: "+result.optInt("sum"));                                }                            }                        } catch (JSONException e) {                            e.printStackTrace();                        }                    }                });    }}