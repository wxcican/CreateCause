package com.mzth.createcause.view.fragment.news.impl;import android.content.Intent;import android.graphics.Color;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.v4.widget.SwipeRefreshLayout;import android.support.v7.widget.LinearLayoutManager;import android.support.v7.widget.RecyclerView;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import com.chad.library.adapter.base.BaseQuickAdapter;import com.mzth.createcause.R;import com.mzth.createcause.adapter.news.NewsAdapter;import com.mzth.createcause.base.BaseFragment;import com.mzth.createcause.entity.core.CoreContentEntity;import com.mzth.createcause.presenter.core.InfromationPresenter;import com.mzth.createcause.util.CommonUtil;import com.mzth.createcause.util.ConfigUtil;import com.mzth.createcause.util.DividerItemDecoration;import com.mzth.createcause.view.fragment.news.INewsContentFragment;import java.util.ArrayList;import java.util.List;/** * Created by Administrator on 2017/11/1 0001. */public class NewsContentFragment extends BaseFragment implements INewsContentFragment {    private RecyclerView rv_news_content_fragment;    private SwipeRefreshLayout srl_news_content_fragment;    private NewsAdapter mNewsAdapter;    private String typeId;    private View view;    private InfromationPresenter mInfromationPresenter;    public NewsContentFragment() {        mNewsAdapter = null;    }    public static NewsContentFragment getNewsContentFragment(String type) {        NewsContentFragment mNewsContentFragment = new NewsContentFragment();        mNewsContentFragment.typeId = type;        return mNewsContentFragment;    }    @Override    protected View createView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {        view = inflater.inflate(R.layout.news_content_fragment, container, false);        mInfromationPresenter = new InfromationPresenter();        mInfromationPresenter.initNewContentFragment(this);        return view;    }    @Override    protected void initView() {        rv_news_content_fragment = view.findViewById(R.id.rv_news_content_fragment);        srl_news_content_fragment = view.findViewById(R.id.srl_news_content_fragment);    }    @Override    protected void initSet() {    }    private List<CoreContentEntity.InfromationContentList> mNewsContentEntitys = new ArrayList<>();    @Override    protected void initAdapter() {        rv_news_content_fragment.setLayoutManager(new LinearLayoutManager(getActivity(), LinearLayoutManager.VERTICAL, false));        rv_news_content_fragment.addItemDecoration(new DividerItemDecoration(getActivity(), LinearLayoutManager.HORIZONTAL,                CommonUtil.getCommonUtil().convertDIP(1),                Color.parseColor("#f2f2f2")));        mNewsAdapter = new NewsAdapter(mNewsContentEntitys);        rv_news_content_fragment.setAdapter(mNewsAdapter);        mNewsAdapter.setEmptyView(mNoDataView);    }    @Override    protected void initListner() {        //详情        mNewsAdapter.setOnItemClickListener(new BaseQuickAdapter.OnItemClickListener() {            @Override            public void onItemClick(BaseQuickAdapter adapter, View view, int position) {                Intent mIntent = new Intent();                mIntent.setClass(getActivity(), NewsInfoActivity.class);                mIntent.putExtra("NEWS_ID",mNewsContentEntitys.get(position).getId());                mIntent.putExtra("NEWS_TITLE",mNewsContentEntitys.get(position).getTitle());                String content = mNewsContentEntitys.get(position).getContent();                mIntent.putExtra("NEWS_CONTENT",content.length()>50?content.substring(0,50):content);                mIntent.putExtra("NEWS_IMG",mNewsContentEntitys.get(position).getImage());                startActivity(mIntent);            }        });        //刷新数据        srl_news_content_fragment.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() {            @Override            public void onRefresh() {                mInfromationPresenter.getRefreshCoreContentData(typeId, "1", "0");            }        });        //加载        mNewsAdapter.setOnLoadMoreListener(new BaseQuickAdapter.RequestLoadMoreListener() {            @Override            public void onLoadMoreRequested() {                page++;                mInfromationPresenter.getLoadCoreContentData(typeId, "1",page+"");            }        });    }    @Override    protected void initData() {        mInfromationPresenter.getCoreContentData(typeId, "1", "0");    }    @Override    public void onRequestStart() {        if (!srl_news_content_fragment.isRefreshing()) {            srl_news_content_fragment.setRefreshing(true);        }    }    @Override    public void onRequestFinish() {        if (srl_news_content_fragment.isRefreshing()) {            srl_news_content_fragment.setRefreshing(false);        }    }    @Override    public void onRequestError() {        CommonUtil.getCommonUtil().toast(ConfigUtil.HINT_OVERTIME);    }    @Override    public void onToast(String content) {        CommonUtil.getCommonUtil().toast(content);    }    @Override    public void infromationContentData(CoreContentEntity coreContentEntity) {        mNewsContentEntitys.clear();        mNewsContentEntitys.addAll(coreContentEntity.getmInfromationContentLists());        mNewsAdapter.notifyDataSetChanged();        pageMessage(coreContentEntity);    }    @Override    public void infromationRefreshContentData(CoreContentEntity coreContentEntity) {        page=0;        mNewsContentEntitys.clear();        mNewsContentEntitys.addAll(coreContentEntity.getmInfromationContentLists());        mNewsAdapter.notifyDataSetChanged();        pageMessage(coreContentEntity);    }    private int page=0;    @Override    public void infromationLoadCoreContentData(CoreContentEntity coreContentEntity) {        mNewsContentEntitys.addAll(coreContentEntity.getmInfromationContentLists());        mNewsAdapter.notifyDataSetChanged();        pageMessage(coreContentEntity);    }    private void pageMessage(CoreContentEntity coreContentEntity){        if((page+1)<coreContentEntity.getPage_total()){            mNewsAdapter.loadMoreComplete();        }else {            mNewsAdapter.loadMoreEnd();        }    }}